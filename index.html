<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Создание изображения через JSON API</title>
</head>
<body>
    <h1>Создание картинки через POST-запрос</h1>
    
    <form id="data-form">
        <label for="size-x">Размер X:</label>
        <input type="number" id="size-x" value="2" required><br>

        <label for="size-y">Размер Y:</label>
        <input type="number" id="size-y" value="2" required><br>

        <label for="data">Данные (например, {255,255,255}):</label>
        <input type="text" id="data" value="{255,0,0},{0,255,0},{0,0,255},{255,255,0}" required><br>

        <button type="submit">Создать изображение</button>
    </form>

    <h2>Результат:</h2>
    <img id="image-result" style="border: 1px solid black;" alt="Сгенерированное изображение"/>

    <script>
        // Обработчик формы
        document.getElementById('data-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const sizeX = parseInt(document.getElementById('size-x').value);
            const sizeY = parseInt(document.getElementById('size-y').value);
            const data = document.getElementById('data').value;

            const parsedData = parseData(data);

            // Формируем JSON для отправки
            const requestData = {
                "size-x": sizeX,
                "size-y": sizeY,
                "data": parsedData
            };

            // Отправляем запрос через fetch (POST)
            generateImage(requestData);
        });

        function parseData(data) {
            const rows = data.split('},{').map(row => {
                return row.replace(/[{}]/g, '').split(',').map(Number);
            });
            return rows;
        }

        function generateImage(data) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const sizeX = data["size-x"];
            const sizeY = data["size-y"];
            canvas.width = sizeX;
            canvas.height = sizeY;

            // Рисуем картину на основе данных
            for (let y = 0; y < sizeY; y++) {
                for (let x = 0; x < sizeX; x++) {
                    const color = data["data"][y * sizeX + x]; // Получаем цвет
                    ctx.fillStyle = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
                    ctx.fillRect(x, y, 1, 1); // Рисуем пиксель
                }
            }

            // Преобразуем в формат Base64 и отправляем в ответ
            const imageUrl = canvas.toDataURL('image/png');

            // Показываем картинку в элементе img
            const img = document.getElementById('image-result');
            img.src = imageUrl;
        }
    </script>
</body>
</html>
